#!/bin/bash

script_preamble() {
    cat <<END_LUA
local __print_lines = {}

local function print(line)
    __print_lines[#__print_lines + 1] = line
end

END_LUA
}

script_postamble() {
    cat <<END_LUA

return '\\n' .. table.concat(__print_lines, '\\n') .. '\\n'
END_LUA
}

# XXX prepare the script
#       bundle lib/*.lua
#       replace require
# XXX pipe to dbus-send instead?
# XXX trim the results

( script_preamble ; cat "$1" ; script_postamble ) | awesome-client
